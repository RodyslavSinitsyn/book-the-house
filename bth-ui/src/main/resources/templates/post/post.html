<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments :: commonHead}"/>
    <title th:text="${post.title}">Post</title>
</head>
<body>
<header th:replace="~{fragments :: header}"></header>

<div class="container max-w-4xl mx-auto px-4 py-6">
    <div th:replace="~{fragments :: postCard(post=${post})}"></div>

    <div class="post-card fadeIn-container max-w-3xl mx-auto mt-4 bg-white shadow-lg rounded-lg overflow-hidden border border-gray-300">
        <!-- Start Chat Button -->
        <a th:href="@{/chat/{chatId}/{recipientId}(chatId=${chatId}, recipientId=${post.username})}"
           th:if="${isAuth and post.username != authenticatedUserId}"
           class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 flex items-center justify-center space-x-2"
           title="Start a conversation with the post owner">
            Start chat
        </a>
        <!-- Subscribe Form -->
        <form id="post-subscribe-form"
              th:action="@{/subscribe}"
              method="POST"
              th:if="${isAuth and post.username != authenticatedUserId}">
            <div class="space-y-4 mt-4">
                <!-- User ID Input -->
                <div class="mb-4">
                    <label for="post-subscribe-friendly-name" class="block text-gray-700 font-medium">Post creator</label>
                    <input th:value="${post.friendlyName}"
                           type="text" id="post-subscribe-friendly-name" name="userId"
                           class="w-full border-gray-300 rounded-md p-2 bg-gray-200"
                           readonly>
                </div>
                <!-- Email Input with Dynamic Readonly -->
                <div class="mb-4">
                    <label for="post-subscribe-email" class="block text-gray-700 font-medium">Your Email</label>
                    <input th:value="${userEmail}"
                           th:classappend="${userEmail != null ? 'bg-gray-200' : ''}"
                           th:attr="readonly=${userEmail != null ? 'readonly' : null}"
                           type="email" id="post-subscribe-email" name="email"
                           class="w-full border-gray-300 rounded-md p-2"
                           placeholder="Enter your email address">
                </div>
                <input th:value="${post.username}"
                       type="hidden"
                       id="post-subscribe-username"
                       name="username"
                       readonly>
                <!-- Subscription Button -->
                <button type="submit"
                        class="w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 flex items-center justify-center space-x-2">
                    <span>Subscribe to User Updates</span>
                </button>
            </div>
        </form>
    </div>
</div>
<footer th:replace="~{fragments :: footer}"></footer>
<script th:src="@{/js/post-subscription.js}" type="text/javascript"></script>
</body>
</html>