<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments :: commonHead}"/>
    <title>Chat</title>
</head>
<body>
<header th:replace="~{fragments :: header}"></header>
<div class="container max-w-4xl mx-auto px-4 py-6 fadeIn-container">
    <div class="bg-white shadow-lg rounded-lg p-6 flex flex-col h-[600px]">
        <!-- Chat Header -->
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-gray-800">
                Chat with <span th:text="${recipientId}">User</span>
            </h2>
        </div>
        <!-- Border under header -->
        <div class="border-b border-gray-300 mb-4"></div>

        <!-- Messages List -->
        <div id="chat-messages" class="flex-grow overflow-y-auto space-y-4">
            <!-- Loop over messages -->
            <div th:each="message : ${messages}">
                <div th:classappend="${message.senderId == senderId} ? 'text-end' : 'text-start'">
                    <div th:classappend="${message.senderId == senderId} ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'"
                         class="p-3 rounded-lg max-w-xs mb-2 inline-block">
                        <span th:text="${message.text}">Message content</span>
                    </div>
                </div>
            </div>
            <!-- Messages will be appended here dynamically -->
        </div>
        <!-- Input Area and Send Button -->
        <div class="flex flex-col items-stretch mt-4 space-y-2">
            <form id="chat-form" class="space-y-4">
                <input type="hidden" id="chatId" th:value="${chatId}">
                <input type="hidden" id="recipientId" th:value="${recipientId}">
                <input type="hidden" id="senderId" th:value="${senderId}">

                <!-- Message Textarea -->
                <textarea id="message" rows="4"
                          class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Type your message..."></textarea>

                <!-- Send Button -->
                <button type="submit"
                        class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Send
                </button>
            </form>
        </div>
    </div>
</div>
<!-- Hidden Template for Message -->
<template id="message-sender-template">
    <div class="text-end">
        <div class="p-3 rounded-lg max-w-xs mb-2 inline-block bg-blue-500 text-white">
            <span class="message-text"></span>
        </div>
    </div>
</template>
<template id="message-receiver-template">
    <div class="text-start">
        <div class="p-3 rounded-lg max-w-xs mb-2 inline-block bg-gray-200 text-gray-800">
            <span class="message-text"></span>
        </div>
    </div>
</template>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
<script th:src="@{/js/chat.js}" type="text/javascript"></script>
</body>
</html>
