databaseChangeLog:
  - changeSet:
      id: 11
      author: rsinitsyn
      comment: Creates 'states' table
      labels: geo
      runAlways: false
      runOnChange: false
      preConditions:
        - onFail: HALT
          not:
            tableExists:
              tableName: states
      rollback:
        - dropTable:
            tableName: states
        - dropSequence:
            sequenceName: states_id_seq
      changes:
        - sql:
            'CREATE TABLE public.states
             (
                 id           bigint                                                NOT NULL,
                 name         character varying(255)                                NOT NULL,
                 country_id   bigint                                                NOT NULL,
                 country_code character varying(2)                                  NOT NULL,
                 fips_code    character varying(255),
                 iso2         character varying(255),
                 type         character varying(191),
                 latitude     numeric(10, 8),
                 longitude    numeric(11, 8),
                 created_at   timestamp without time zone,
                 updated_at   timestamp without time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
                 flag         smallint                    DEFAULT 1                 NOT NULL,
                 wiki_data_id character varying(255)
             );
             ALTER TABLE public.states
                 ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
                     SEQUENCE NAME public.states_id_seq
                     START WITH 1
                     INCREMENT BY 1
                     NO MINVALUE
                     NO MAXVALUE
                     CACHE 1
                     );

             ALTER TABLE ONLY public.states
                 ADD CONSTRAINT states_pkey PRIMARY KEY (id);
             CREATE INDEX states_country_id_idx ON public.states USING btree (country_id);
             ALTER TABLE ONLY public.states
                 ADD CONSTRAINT states_country_id_fkey FOREIGN KEY (country_id) REFERENCES public.countries (id);
             '